<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá Th·ªëng Qu·∫£n L√Ω Kho - FMSTYLE</title>
    <link rel="stylesheet" href="../css/style.css">
</head>

<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h1 data-text="FMSTYLE">FMSTYLE</h1>
                <p>H·ªá Th·ªëng Qu·∫£n L√Ω Kho</p>
            </div>
            <div class="menu-item active" onclick="showPage('dashboard', this)">
                <span class="menu-item-icon">üìä</span>
                <span>T·ªïng Quan</span>
            </div>
            <div class="menu-item" onclick="showPage('phieunhap', this)">
                <span class="menu-item-icon">üì•</span>
                <span>Phi·∫øu Nh·∫≠p H√†ng</span>
            </div>
            <div class="menu-item" onclick="showPage('hanghoa', this)">
                <span class="menu-item-icon">üì¶</span>
                <span>H√†ng H√≥a</span>
            </div>
            <div class="menu-item" onclick="showPage('lichsu', this)">
                <span class="menu-item-icon">üìã</span>
                <span>L·ªãch S·ª≠</span>
            </div>
            <button class="logout-btn" onclick="logout()">ƒêƒÉng Xu·∫•t</button>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div id="page-content">
                <!-- Content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Notification Section -->
    <div id="notification-section" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.6); z-index: 9999; overflow-y: auto; padding: 20px; backdrop-filter: blur(5px); box-sizing: border-box;">
        <div style="max-width: 900px; width: 100%; margin: 40px auto; background: white; border-radius: 16px; padding: 0; box-shadow: 0 20px 60px rgba(0,0,0,0.3); animation: modalSlideIn 0.3s ease; position: relative;">
            <div style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%); padding: 25px; border-radius: 16px 16px 0 0; color: white;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 style="margin: 0; font-size: 22px; font-weight: 700; display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 32px;">üîî</span>
                        <span>Th√¥ng B√°o H·ªá Th·ªëng</span>
                    </h2>
                    <button onclick="closeNotificationSection()" style="background: rgba(255,255,255,0.2); color: white; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-size: 18px; font-weight: 600; transition: all 0.3s;"
                            onmouseover="this.style.background='rgba(255,255,255,0.3)'" 
                            onmouseout="this.style.background='rgba(255,255,255,0.2)'">‚úï</button>
                </div>
            </div>
            
            <div style="padding: 25px; max-height: calc(100vh - 200px); overflow-y: auto;">
                <!-- Low Stock Warnings -->
                <div id="notification-low-stock" style="margin-bottom: 25px;">
                    <div style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); padding: 20px; border-radius: 12px; border-left: 5px solid #ff9800; margin-bottom: 15px;">
                        <h3 style="margin: 0 0 15px 0; color: #e65100; font-size: 18px; font-weight: 700; display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 24px;">‚ö†Ô∏è</span>
                            <span>C·∫£nh B√°o H√†ng T·ªìn Kho Th·∫•p</span>
                        </h3>
                        <div id="low-stock-list" style="display: grid; gap: 10px;"></div>
                    </div>
                </div>
                
                <div id="notification-slow-moving" style="margin-bottom: 25px;">
                    <div style="background: linear-gradient(135deg, #fce4ec 0%, #f8bbd0 100%); padding: 20px; border-radius: 12px; border-left: 5px solid #e91e63; margin-bottom: 15px;">
                        <h3 style="margin: 0 0 15px 0; color: #c2185b; font-size: 18px; font-weight: 700; display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 24px;">üêå</span>
                            <span>C·∫£nh B√°o H√†ng T·ªìn B√°n Ch·∫≠m</span>
                        </h3>
                        <div id="slow-moving-list" style="display: grid; gap: 10px;"></div>
                    </div>
                </div>
                
                <!-- Empty State -->
                <div id="notification-empty" style="text-align: center; padding: 40px 20px; display: none;">
                    <div style="font-size: 64px; margin-bottom: 15px;">‚úÖ</div>
                    <h3 style="color: #4caf50; font-size: 20px; margin-bottom: 10px;">Kh√¥ng c√≥ c·∫£nh b√°o</h3>
                    <p style="color: #999; font-size: 14px;">T·∫•t c·∫£ s·∫£n ph·∫©m ƒë·ªÅu trong tr·∫°ng th√°i t·ªët!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Th√™m m·ªõi</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div id="modal-body">
                <!-- Form will be loaded here -->
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../js/pages.js"></script>
    <script src="../js/api.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/app.js"></script>
    <script>
        // Check authentication - cho ph√©p warehouse ho·∫∑c admin
        const user = JSON.parse(localStorage.getItem("user"));
        if (!user) {
            window.location.href = "login.html";
        } else if (user.role !== 'warehouse' && user.role !== 'admin') {
            // Ki·ªÉm tra xem c√≥ ph·∫£i th·ªß kho kh√¥ng (d·ª±a v√†o v·ªã tr√≠)
            // N·∫øu kh√¥ng ph·∫£i warehouse ho·∫∑c admin, ki·ªÉm tra v·ªã tr√≠
            alert('B·∫°n kh√¥ng c√≥ quy·ªÅn truy c·∫≠p trang n√†y!');
            window.location.href = "login.html";
        }
        
        // Override showPage ƒë·ªÉ ch·ªâ cho ph√©p c√°c trang warehouse
        const originalShowPage = window.showPage;
        window.showPage = function(pageName, element) {
            const allowedPages = ['dashboard', 'phieunhap', 'hanghoa', 'lichsu'];
            if (!allowedPages.includes(pageName)) {
                showAlert('B·∫°n kh√¥ng c√≥ quy·ªÅn truy c·∫≠p trang n√†y', 'error');
                return;
            }
            
            if (originalShowPage) {
                originalShowPage(pageName, element);
            } else {
                currentPage = pageName;
                loadPage();
            }
        };
        
        // Initialize - load dashboard by default
        window.addEventListener('DOMContentLoaded', async function() {
            initModalClose();
            currentPage = 'dashboard';
            // Activate dashboard menu item
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            const dashboardMenuItem = document.querySelector('.menu-item[onclick*="dashboard"]');
            if (dashboardMenuItem) {
                dashboardMenuItem.classList.add('active');
            }
            // Load dashboard
            await loadDashboardInitialData();
            await loadPage();
            // Update notification badge after loading data
            if (typeof updateNotificationBadge === 'function') {
                updateNotificationBadge();
            }
        });
        
        // Ensure openNotificationSection and closeNotificationSection are available
        if (typeof openNotificationSection === 'undefined') {
            window.openNotificationSection = function() {
                const section = document.getElementById('notification-section');
                if (section) {
                    section.style.display = 'block';
                    section.scrollTop = 0;
                    if (typeof loadNotificationData === 'function') {
                        loadNotificationData();
                    }
                }
            };
        }
        
        if (typeof closeNotificationSection === 'undefined') {
            window.closeNotificationSection = function() {
                const section = document.getElementById('notification-section');
                if (section) {
                    section.style.display = 'none';
                }
            };
        }
    </script>
</body>
</html>

